<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MIVO ‚Äî Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --bg-light: #f8fafc;
      --bg-dark: #333333;
      --surface-light: #ffffff;
      --surface-dark: #404040;
      --text-light: #334155;
      --text-dark: #e2e8f0;
      --primary: #3b82f6;
      --primary-hover: #2563eb;
      --shadow-light: rgba(0, 0, 0, 0.1);
      --shadow-dark: rgba(0, 0, 0, 0.3);
    }

    .dark {
      --bg: var(--bg-dark);
      --surface: var(--surface-dark);
      --text: var(--text-dark);
      --shadow: var(--shadow-dark);
    }

    .light {
      --bg: var(--bg-light);
      --surface: var(--surface-light);
      --text: var(--text-light);
      --shadow: var(--shadow-light);
    }

    body {
      background: var(--bg);
      color: var(--text);
      transition: all 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in { animation: fadeIn 0.25s ease forwards; }

    /* –ù–µ–æ–º–æ—Ä—Ñ–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    .neo-btn {
      background: var(--surface);
      border-radius: 12px;
      box-shadow: 
        6px 6px 12px var(--shadow),
        -6px -6px 12px rgba(255, 255, 255, 0.1);
      transition: all 0.2s ease;
      border: none;
      cursor: pointer;
    }

    .neo-btn:hover {
      transform: translateY(-2px);
      box-shadow: 
        8px 8px 16px var(--shadow),
        -8px -8px 16px rgba(255, 255, 255, 0.15);
    }

    .neo-btn:active {
      transform: translateY(1px);
      box-shadow: 
        3px 3px 6px var(--shadow),
        -3px -3px 6px rgba(255, 255, 255, 0.05);
    }

    /* –ê–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ */
    .filter-btn {
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
    }

    .filter-btn.active {
      background: var(--primary);
      color: white;
      box-shadow: 
        inset 3px 3px 6px rgba(0, 0, 0, 0.2),
        6px 6px 12px var(--shadow);
    }

    /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
    .theme-toggle {
      width: 50px;
      height: 28px;
      padding: 2px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      background: var(--surface);
      border-radius: 50px;
      position: relative;
    }

    .theme-toggle.dark {
      justify-content: flex-end;
    }

    .theme-toggle-inner {
      width: 24px;
      height: 24px;
      background: var(--primary);
      border-radius: 50%;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    /* –ö—Ä—É–≥–ª–∞—è –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ */
    .send-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 
        4px 4px 8px var(--shadow),
        -4px -4px 8px rgba(255, 255, 255, 0.1);
      transition: all 0.2s ease;
    }

    .send-btn:hover {
      background: var(--primary-hover);
      transform: scale(1.05);
    }

    .send-btn:active {
      transform: scale(0.95);
    }

    /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
    .neo-input {
      background: var(--surface);
      border: none;
      border-radius: 12px;
      padding: 12px 16px;
      color: var(--text);
      box-shadow: 
        inset 3px 3px 6px var(--shadow),
        inset -3px -3px 6px rgba(255, 255, 255, 0.1);
      transition: all 0.2s ease;
    }

    .neo-input:focus {
      outline: none;
      box-shadow: 
        inset 3px 3px 6px var(--shadow),
        inset -3px -3px 6px rgba(255, 255, 255, 0.1),
        0 0 0 2px var(--primary);
    }

    .neo-input::placeholder {
      color: rgba(var(--text), 0.6);
    }

    /* –ü—É–∑—ã—Ä–∏ —Å–æ–æ–±—â–µ–Ω–∏–π */
    .msg-bubble {
      white-space: pre-wrap;
      word-wrap: break-word;
      border-radius: 20px;
      box-shadow: 
        4px 4px 8px var(--shadow),
        -4px -4px 8px rgba(255, 255, 255, 0.1);
    }

    .msg-bubble.user {
      background: linear-gradient(135deg, var(--primary), #1d4ed8);
      color: white;
    }

    .msg-bubble.bot {
      background: var(--surface);
      color: var(--text);
    }

    /* Typing dots */
    .typing { display: inline-flex; gap: 6px; align-items: flex-end; height: 18px; }
    .dot { width: 6px; height: 6px; background: var(--primary); border-radius: 50%; }
    .dot:nth-child(1) { animation: jump 0.9s infinite 0s; }
    .dot:nth-child(2) { animation: jump 0.9s infinite .12s; }
    .dot:nth-child(3) { animation: jump 0.9s infinite .24s; }
    @keyframes jump {
      0% { transform: translateY(0); opacity: 0.9; }
      30% { transform: translateY(-6px); opacity: 1; }
      60% { transform: translateY(0); opacity: 0.9; }
      100% { transform: translateY(0); opacity: 0.85; }
    }

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */
    .logo {
      background: linear-gradient(135deg, var(--primary), #1d4ed8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
      font-size: 24px;
    }
  </style>
</head>
<body class="light">
  <div class="max-w-2xl mx-auto h-screen flex flex-col">
    <!-- Header -->
    <div class="flex items-center justify-between p-4 border-b border-opacity-20" style="border-color: var(--shadow)">
      <div class="flex items-center gap-3">
        <div class="logo">MIVO</div>
        <div class="w-3 h-3 rounded-full" style="background: var(--primary);"></div>
      </div>
      <div class="flex items-center gap-3">
        <button id="themeToggle" class="theme-toggle neo-btn">
          <div class="theme-toggle-inner">üåô</div>
        </button>
      </div>
    </div>

    <!-- Filters -->
    <div class="p-3 border-b border-opacity-20 flex flex-wrap gap-2" id="filtersRow" style="border-color: var(--shadow)"></div>

    <!-- Chat area -->
    <div id="chat" class="flex-1 p-4 space-y-4 overflow-y-auto"></div>

    <!-- Input -->
    <div class="p-4">
      <div class="flex gap-3 items-center">
        <input id="inp" class="flex-1 neo-input" placeholder="–ñ–∞“£–∞ —Å—Ü–µ–Ω–∞—Ä–∏–π –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑‚Ä¶" />
        <button id="send" class="send-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <script>
    const BASE_URL = "http://localhost:8000";
    const filters = ["–°—Ç–∞–Ω–¥–∞—Ä—Ç","–ú–æ—Ç–∏–≤–∞—Ü–∏—è–ª—ã“õ","–ñ–∞—Ä–Ω–∞–º–∞–ª—ã“õ","–ö–æ–º–µ–¥–∏—è–ª—ã“õ","–ë—ñ–ª—ñ–º–¥—ñ","–î—Ä–∞–º–∞–ª—ã“õ"];
    let activeFilter = "–°—Ç–∞–Ω–¥–∞—Ä—Ç";
    const chat = document.getElementById('chat');

    // === Theme ===
    const themeToggle = document.getElementById('themeToggle');
    const themeInner = themeToggle.querySelector('.theme-toggle-inner');
    
    function applyTheme() {
      const isDark = localStorage.getItem('theme') === 'dark' || 
        (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);
      
      document.body.className = isDark ? 'dark' : 'light';
      themeToggle.classList.toggle('dark', isDark);
      themeInner.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      if (isDark) {
        document.documentElement.style.setProperty('--bg', 'var(--bg-dark)');
        document.documentElement.style.setProperty('--surface', 'var(--surface-dark)');
        document.documentElement.style.setProperty('--text', 'var(--text-dark)');
        document.documentElement.style.setProperty('--shadow', 'var(--shadow-dark)');
      } else {
        document.documentElement.style.setProperty('--bg', 'var(--bg-light)');
        document.documentElement.style.setProperty('--surface', 'var(--surface-light)');
        document.documentElement.style.setProperty('--text', 'var(--text-light)');
        document.documentElement.style.setProperty('--shadow', 'var(--shadow-light)');
      }
      
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }

    themeToggle.addEventListener('click', () => {
      const currentTheme = localStorage.getItem('theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      localStorage.setItem('theme', newTheme);
      applyTheme();
    });
    
    applyTheme();

    // === Filters ===
    function renderFilters(){
      const row = document.getElementById('filtersRow');
      row.innerHTML = '';
      filters.forEach(f => {
        const btn = document.createElement('button');
        btn.textContent = f;
        btn.className = 'filter-btn neo-btn' + (f === activeFilter ? ' active' : '');
        btn.onclick = () => {
          activeFilter = f;
          renderFilters();
        };
        row.appendChild(btn);
      });
    }
    renderFilters();

    // === Chat helpers ===
    function addMsg(text, me = false, withRewrite = false, origReq = null) {
      const wrap = document.createElement('div');
      wrap.className = 'flex ' + (me ? 'justify-end' : 'justify-start') + ' fade-in';
      
      const bubble = document.createElement('div');
      bubble.className = 'msg-bubble p-4 max-w-[75%] ' + (me ? 'user' : 'bot');
      
      if (!me && withRewrite) {
        const content = document.createElement('div');
        content.textContent = "";
        bubble.appendChild(content);
        // animate typing
        typeWriter(content, text, 0);
        // add rewrite button
        const btn = document.createElement('button');
        btn.textContent = 'üîÑ “ö–∞–π—Ç–∞ –∂–∞–∑—É';
        btn.className = 'mt-3 text-sm px-3 py-2 neo-btn text-white';
        btn.style.background = 'var(--primary)';
        btn.onclick = () => sendMsg(origReq, true);
        bubble.appendChild(btn);
      } else {
        bubble.textContent = text;
      }

      wrap.appendChild(bubble);
      chat.appendChild(wrap);
      chat.scrollTop = chat.scrollHeight;
    }

    function typeWriter(el, text, i) {
      if (i < text.length) {
        el.textContent += text.charAt(i);
        setTimeout(() => typeWriter(el, text, i + 1), 12);
      }
    }

    function setTyping(on) {
      let el = document.getElementById('typing');
      if (on) {
        if (el) return;
        el = document.createElement('div');
        el.id = 'typing';
        el.className = 'flex justify-start fade-in';
        el.innerHTML = `<div class="msg-bubble bot p-4 max-w-[40%] flex items-center">
          <div class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>
          <div class="ml-3 text-sm opacity-60">–ñ–∞—É–∞–ø –∂–∞–∑—ã–ª—ã–ø –∂–∞—Ç—ã—Ä‚Ä¶</div></div>`;
        chat.appendChild(el);
        chat.scrollTop = chat.scrollHeight;
      } else {
        if (el) el.remove();
      }
    }

    // === Send logic ===
    const inp = document.getElementById('inp'), send = document.getElementById('send');
    
    async function sendMsg(textInput = null, isRewrite = false) {
      const text = textInput || inp.value.trim();
      if (!text) return;
      
      if (!isRewrite) addMsg(text, true);
      inp.value = '';
      setTyping(true);
      
      const composed = `–°—Ç–∏–ª—å: ${activeFilter}\n–°“±—Ä–∞–Ω—ã—Å: ${text}`;
      
      try {
        const res = await fetch(BASE_URL + '/chat', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({message: composed})
        });
        
        setTyping(false);
        const data = await res.json();
        
        if (res.ok) {
          addMsg(data.reply, false, true, text);
        } else {
          addMsg('“ö–∞—Ç–µ: ' + (data.detail || '—Å–µ—Ä–≤–µ—Ä “õ–∞—Ç–µ—Å—ñ'), false);
        }
      } catch (e) {
        setTyping(false);
        addMsg('“ö–∞—Ç–µ: –∂–µ–ª—ñ–≥–µ “õ–æ—Å—ã–ª—É –º“Ø–º–∫—ñ–Ω –µ–º–µ—Å.', false);
      }
    }
    
    send.onclick = () => sendMsg();
    inp.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMsg();
    });

    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    addMsg('–°”ô–ª–µ–º! –ú–µ–Ω MIVO-–º—ã–Ω. –°—Ü–µ–Ω–∞—Ä–∏–π–ª–µ—Ä—ñ“£—ñ–∑–¥—ñ –µ–Ω–≥—ñ–∑—É–≥–µ –¥–∞–π—ã–Ω–º—ã–Ω.');
  </script>
</body>
</html>